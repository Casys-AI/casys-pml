# MCP Tool Permission Metadata
#
# IMPORTANT: These are NOT sandbox permissions!
# The Deno Worker sandbox ALWAYS runs with permissions: "none" (most restrictive).
# All I/O goes through MCP RPC proxy for 100% traceability.
#
# This file defines METADATA used for:
#   1. Validation detection - Does this DAG need per-layer human approval?
#   2. Audit logging - What scope does this tool claim to use?
#   3. Permission inference - What permissions would this tool need?
#
# =============================================================================
# Configuration Format
# =============================================================================
#
# Two formats supported:
#
# 1. Shorthand (backward compatible):
#    github:
#      permissionSet: network-api
#      isReadOnly: false
#
# 2. Explicit (recommended for new entries):
#    numpy:
#      scope: minimal        # minimal|readonly|filesystem|network-api|mcp-standard
#      ffi: true             # FFI required (triggers validation)
#      run: false            # Subprocess required (triggers validation)
#      approvalMode: auto    # auto = works freely, hil = requires approval
#
# Shorthand defaults: scope=permissionSet, ffi=false, run=false, approvalMode=auto
#
# =============================================================================
# Scope Levels (metadata only - not enforced in sandbox)
# =============================================================================
#   - minimal: Pure computation, no I/O
#   - readonly: Read files only
#   - filesystem: Read + write files
#   - network-api: Network access
#   - mcp-standard: Full MCP capabilities
#
# =============================================================================
# Validation Rules (requiresValidation in workflow-execution-handler.ts)
# =============================================================================
# Per-layer validation is triggered when:
#   - approvalMode: hil (explicit human approval)
#   - ffi: true (FFI sandbox escape)
#   - run: true (subprocess sandbox escape)
#   - code_execution with non-minimal permissions
#
# Note: 'trusted' is deprecated - use explicit format with approvalMode: auto
# Unknown tools default to: mcp-standard scope, approvalMode: auto

# Filesystem tools - local file operations
filesystem:
  permissionSet: filesystem
  isReadOnly: false

fs:
  permissionSet: filesystem
  isReadOnly: false

# Network API tools - external service calls
github:
  permissionSet: network-api
  isReadOnly: false

slack:
  permissionSet: network-api
  isReadOnly: false

tavily:
  permissionSet: network-api
  isReadOnly: false

api:
  permissionSet: network-api
  isReadOnly: false

# Mixed/container tools - need broader permissions
kubernetes:
  permissionSet: mcp-standard
  isReadOnly: false

docker:
  permissionSet: mcp-standard
  isReadOnly: false

# Database tools
postgres:
  permissionSet: network-api
  isReadOnly: false

sqlite:
  permissionSet: filesystem
  isReadOnly: false

# Search/AI tools
# Note: brave-search requires bracket notation mcp["brave-search"]
# which AST parser handles differently - use underscore version
brave_search:
  permissionSet: network-api
  isReadOnly: false

# Memory/context tools
# Note: Even local memory tools need mcp-standard since they're MCP calls
memory:
  permissionSet: mcp-standard
  isReadOnly: true

context7:
  permissionSet: network-api
  isReadOnly: true

# Playwright/browser automation
playwright:
  permissionSet: mcp-standard
  isReadOnly: false

# Sequential thinking - pure computation
sequential-thinking:
  permissionSet: minimal
  isReadOnly: true

# Exa search - network API
exa:
  permissionSet: network-api
  isReadOnly: true

# Magic (21st.dev) - network API
magic:
  permissionSet: network-api
  isReadOnly: true

# Fetch - network API
fetch:
  permissionSet: network-api
  isReadOnly: true

# =============================================================================
# STD (lib/std/) - Standard library tools, 94 tools across 15 categories
# =============================================================================

# Text manipulation - pure computation
text:
  permissionSet: minimal
  isReadOnly: true

# JSON operations - pure computation
json:
  permissionSet: minimal
  isReadOnly: true

# Math operations - pure computation
math:
  permissionSet: minimal
  isReadOnly: true

# DateTime operations - pure computation
datetime:
  permissionSet: minimal
  isReadOnly: true

# Crypto operations (hash, uuid, base64) - pure computation
crypto:
  permissionSet: minimal
  isReadOnly: true

# Collection operations (map, filter, sort) - pure computation
collections:
  permissionSet: minimal
  isReadOnly: true

# Data generation (fake_name, lorem) - pure computation
data:
  permissionSet: minimal
  isReadOnly: true

# Validation (email, url, pattern) - pure computation
validation:
  permissionSet: minimal
  isReadOnly: true

# Format (number, bytes, duration) - pure computation
format:
  permissionSet: minimal
  isReadOnly: true

# Transform (csv_parse, xml) - pure computation
transform:
  permissionSet: minimal
  isReadOnly: true

# Compare (diff, levenshtein, similarity) - pure computation
compare:
  permissionSet: minimal
  isReadOnly: true

# Algo (binary_search, group_aggregate, top_n) - pure computation
algo:
  permissionSet: minimal
  isReadOnly: true

# State (KV store with TTL) - in-memory, no persistence
state:
  permissionSet: minimal
  isReadOnly: false

# HTTP helpers (build_url, parse_url, headers) - pure computation (no actual network)
http:
  permissionSet: minimal
  isReadOnly: true

# Virtual filesystem (in-memory Map, no real disk access)
vfs:
  permissionSet: minimal
  isReadOnly: false

# Note: 'vfs' (virtual filesystem) is in-memory only, no real disk access
# The real filesystem MCP server is defined above as 'filesystem'

# =============================================================================
# FFI-ENABLED TOOLS (explicit format with sandbox escape permissions)
# =============================================================================

# Plots MCP (mcp-plots) - Generate visualizations (line, bar, scatter, etc.)
# Requires Python + uvx to be installed on the host
plots:
  scope: filesystem
  ffi: true
  run: false
  approvalMode: auto
