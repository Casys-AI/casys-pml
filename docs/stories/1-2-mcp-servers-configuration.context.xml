<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>2</storyId>
    <title>MCP Servers Configuration</title>
    <status>drafted</status>
    <generatedAt>2025-12-01</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/1-2-mcp-servers-configuration.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>playground user</asA>
    <iWant>MCP servers pre-configured</iWant>
    <soThat>I can run demos without manual server setup</soThat>
    <tasks>
      <task id="1" ac="1">
        <description>Create configuration directory structure</description>
        <subtasks>
          <subtask>Create `playground/config/` directory if not exists</subtask>
          <subtask>Verify directory is accessible in Codespace environment</subtask>
        </subtasks>
      </task>
      <task id="2" ac="1,2">
        <description>Create MCP servers configuration file</description>
        <subtasks>
          <subtask>Create `playground/config/mcp-servers.json`</subtask>
          <subtask>Configure `@modelcontextprotocol/server-filesystem` with Codespace workspace paths</subtask>
          <subtask>Configure `@modelcontextprotocol/server-memory` (no special path required)</subtask>
          <subtask>Configure `@modelcontextprotocol/server-sequential-thinking` (no special path required)</subtask>
          <subtask>Use correct command format (`npx`, `uvx`) per server type</subtask>
        </subtasks>
      </task>
      <task id="3" ac="3">
        <description>Add inline documentation</description>
        <subtasks>
          <subtask>Add JSON comments explaining each server's purpose</subtask>
          <subtask>Document filesystem server's allowed paths</subtask>
          <subtask>Document memory server's knowledge graph capabilities</subtask>
          <subtask>Document sequential-thinking server's branching features</subtask>
          <subtask>Add reference to research document for more details</subtask>
        </subtasks>
      </task>
      <task id="4" ac="1,2,3">
        <description>Validate configuration</description>
        <subtasks>
          <subtask>Verify JSON syntax is valid</subtask>
          <subtask>Test that paths resolve correctly in Codespace</subtask>
          <subtask>Verify server commands match official MCP documentation</subtask>
        </subtasks>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="1">
      <description>`playground/config/mcp-servers.json` contient 3 servers Tier 1: @modelcontextprotocol/server-filesystem, @modelcontextprotocol/server-memory, @modelcontextprotocol/server-sequential-thinking</description>
    </criterion>
    <criterion id="2">
      <description>Paths configurés pour le workspace Codespace (relatifs ou absolus selon le contexte)</description>
    </criterion>
    <criterion id="3">
      <description>Documentation inline expliquant chaque server (commentaires dans la config JSON)</description>
    </criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/PRD-playground.md</path>
        <title>Casys MCP Gateway Playground - PRD</title>
        <section>FR015 - MCP Servers Tier 1</section>
        <snippet>Le playground doit inclure 3 MCP servers Tier 1 sans clé API : @modelcontextprotocol/server-filesystem (parallélisation lecture fichiers), @modelcontextprotocol/server-memory (knowledge graph local), @modelcontextprotocol/server-sequential-thinking (branchement DAG)</snippet>
      </doc>
      <doc>
        <path>docs/research/mcp-servers-playground-analysis.md</path>
        <title>Analyse des MCP Servers pour Playground Pédagogique</title>
        <section>4.1 Configuration Minimale (Débutant)</section>
        <snippet>Configuration de base avec 3 servers pour démontrer parallélisation DAG simple. Chaque serveur utilise npx ou uvx selon le langage (TypeScript/Python). Filesystem nécessite un chemin autorisé pour sécurité.</snippet>
      </doc>
      <doc>
        <path>docs/research/mcp-servers-playground-analysis.md</path>
        <title>Analyse des MCP Servers pour Playground Pédagogique</title>
        <section>2.1 Filesystem Server</section>
        <snippet>9 outils disponibles incluant read_multiple_files pour parallélisation, nécessite paths sécurisés. Installation: npx -y @modelcontextprotocol/server-filesystem /path/to/allowed/files</snippet>
      </doc>
      <doc>
        <path>docs/research/mcp-servers-playground-analysis.md</path>
        <title>Analyse des MCP Servers pour Playground Pédagogique</title>
        <section>2.2 Memory Server (Knowledge Graph)</section>
        <snippet>9 outils pour knowledge graph local avec create_entities, create_relations, search_nodes. Aucune configuration de chemin requise. Installation: npx -y @modelcontextprotocol/server-memory</snippet>
      </doc>
      <doc>
        <path>docs/research/mcp-servers-playground-analysis.md</path>
        <title>Analyse des MCP Servers pour Playground Pédagogique</title>
        <section>2.3 Sequential Thinking Server</section>
        <snippet>Outil de résolution de problèmes structurée avec support de branchement DAG via branchFromThought et branchId. Installation: npx -y @modelcontextprotocol/server-sequential-thinking</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>.mcp.json</path>
        <kind>config</kind>
        <symbol>mcpServers</symbol>
        <lines>1-15</lines>
        <reason>Exemple de structure JSON MCP existante dans le projet, montre le format standard pour configuration serveurs MCP</reason>
      </artifact>
      <artifact>
        <path>deno.json</path>
        <kind>config</kind>
        <symbol>imports["@modelcontextprotocol/sdk"]</symbol>
        <lines>63</lines>
        <reason>Dépendance MCP SDK déjà présente dans le projet, version ^1.0.4</reason>
      </artifact>
      <artifact>
        <path>.devcontainer/playground/Dockerfile</path>
        <kind>infrastructure</kind>
        <symbol>Node.js environment</symbol>
        <lines>n/a</lines>
        <reason>Devcontainer configuré dans story 1.1 avec Node.js disponible pour npx commands</reason>
      </artifact>
    </code>
    <dependencies>
      <deno>
        <package name="@modelcontextprotocol/sdk" version="^1.0.4">MCP SDK officiel</package>
        <package name="@std/fs" version="1.0.19">File system operations</package>
        <package name="@std/yaml" version="1.0.10">YAML parsing (si besoin)</package>
      </deno>
      <npm>
        <package name="@modelcontextprotocol/server-filesystem" version="latest">Server Tier 1 - Filesystem operations</package>
        <package name="@modelcontextprotocol/server-memory" version="latest">Server Tier 1 - Knowledge graph</package>
        <package name="@modelcontextprotocol/server-sequential-thinking" version="latest">Server Tier 1 - DAG branching</package>
      </npm>
      <runtime>
        <dependency>Node.js (via devcontainer) - requis pour npx</dependency>
        <dependency>Deno 2.1.4 (via devcontainer) - runtime principal</dependency>
      </runtime>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>Configuration JSON standard MCP (format mcpServers object)</constraint>
    <constraint>Chaque serveur nécessite: command (executable), args (array), optional env (object)</constraint>
    <constraint>Filesystem server DOIT avoir explicitement allowed paths pour sécurité</constraint>
    <constraint>Utiliser npx pour packages npm (@modelcontextprotocol/*), uvx pour packages Python (non applicable ici)</constraint>
    <constraint>Paths doivent être adaptés au workspace Codespace (/workspaces/AgentCards ou similaire)</constraint>
    <constraint>Pas de commentaires dans JSON standard - documenter via README ou inline si format JSONC supporté</constraint>
    <constraint>Configuration doit être dans playground/config/ pour isolation du code production</constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>MCP Server Configuration Schema</name>
      <kind>JSON Schema</kind>
      <signature>{
  "mcpServers": {
    "[serverName]": {
      "command": "string",
      "args": "string[]",
      "env": "object (optional)"
    }
  }
}</signature>
      <path>Format standard MCP Protocol</path>
    </interface>
    <interface>
      <name>Filesystem Server Command</name>
      <kind>CLI</kind>
      <signature>npx -y @modelcontextprotocol/server-filesystem /path/to/allowed/directory</signature>
      <path>Package NPM</path>
    </interface>
    <interface>
      <name>Memory Server Command</name>
      <kind>CLI</kind>
      <signature>npx -y @modelcontextprotocol/server-memory</signature>
      <path>Package NPM</path>
    </interface>
    <interface>
      <name>Sequential Thinking Server Command</name>
      <kind>CLI</kind>
      <signature>npx -y @modelcontextprotocol/server-sequential-thinking</signature>
      <path>Package NPM</path>
    </interface>
  </interfaces>

  <tests>
    <standards>
Le projet utilise Deno test framework (deno test --allow-all). Les tests sont organisés en tests/unit/, tests/integration/, tests/e2e/. Pour cette story de configuration, la validation sera principalement manuelle (JSON syntax, path resolution) plutôt qu'unitaire. Les tests devraient vérifier: syntaxe JSON valide, existence des paths configurés, disponibilité des commandes npx.
    </standards>
    <locations>
      <location>tests/unit/</location>
      <location>tests/integration/</location>
      <location>Manual validation in Codespace environment</location>
    </locations>
    <ideas>
      <idea ac="1">Test: Verify JSON file exists at playground/config/mcp-servers.json</idea>
      <idea ac="1">Test: Parse JSON and verify 3 servers are configured (filesystem, memory, sequential-thinking)</idea>
      <idea ac="2">Test: Verify filesystem server has allowed paths that exist in Codespace</idea>
      <idea ac="2">Test: Verify paths are either absolute or relative and resolve correctly</idea>
      <idea ac="3">Manual: Review JSON comments/documentation for clarity (if JSONC format used)</idea>
      <idea ac="all">Integration test: Attempt to load config with MCP client to verify format compatibility</idea>
      <idea ac="all">Manual: Run npx commands to verify servers can be invoked successfully</idea>
    </ideas>
  </tests>
</story-context>
